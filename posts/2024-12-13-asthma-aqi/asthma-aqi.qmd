---
title: "Wildfires and Respiratory Health in California"
description: "Examining the Effect of Wildfire and AQI on Asthma"
author:
  - name: Haylee Oyler
    url: https://haylee360.github.io/
    affiliation: MEDS
    affiliation-url: https://bren.ucsb.edu/masters-programs/master-environmental-data-science
date: '2024-12-13'
categories:
  - Environmental-Health
  - R
  - Statistics
  - MEDS
  - EDS-222
toc: true
# bibliography: references.bib
# csl: plos-computational-biology.csl
image: napa-fire.png
citation:
  url: https://haylee360.github.io/posts/2024-12-asthma-aqi/
# draft: true
# draft-mode: visible
format: html
editor: source
execute:
  warning: false
  message: false
editor_options: 
  chunk_output_type: console
---

The full code for this analysis can be accessed at [this repository](https://github.com/haylee360/eds222-final-project)

## Introduction

Asthma affects an estimated 262 million people and is the most common chronic disease among children[^1]. It is caused by inflammation in the small airways of the lungs that leads to wheezing, coughing, and shortness of breath. While inhaled medications can manage effectively manage symptoms, if left untreated, asthma attacks can be fatal. In fact, over 450,000 people died from asthma worldwide in 2019.

Many things can trigger asthma symptoms. One example is fine particulate matter (PM). Scientists measure PM at two scales, PM 10 and PM 2.5, where the number refers to the size of the particles in micrograms. PM 2.5 is especially concerning for people with respiratory conditions such as asthma because its small size means it can get into even the narrowest of airways, causing irritation and inflammation[^2]. 

PM 2.5 can come from many sources, from industrial pollution to car exhaust, but recent research has shown that PM 2.5 from wildfires is particularly harmful[^3]. As wildfire regimes get more more volatile and extreme under climate change, more people will be exposed to these harmful particles[^4]. 

While it is difficult to directly measure PM 2.5 from wildfires, one useful proxy for wildfire air pollution is air quality. The Air Quality Index (AQI) is a measure of how polluted the air is. It is calculated based on the concentrations of a number of common pollutants (Ozone, particulate matter, CO, NO2, SO2) present in the air[^5]. 

This analysis will use AQI data as a proxy for wildfire to explore how changing wildfire regimes are affecting the prevalence of asthma. 

## Data

I will use data from a number of sources to answer this question. 

- [Air Quality Index (AQI) data](https://aqs.epa.gov/aqsweb/airdata/download_files.html#Annual) by county was retrieved from the EPA[^6].

- [Yearly asthma hospitalization counts by county](https://data.ca.gov/dataset/asthma-emergency-department-visit-rates) were retrieved from the California Health and Human Services (CHHS) Open Data Portal[^7].

- [Fire frequency and area burned data](https://www.fire.ca.gov/what-we-do/fire-resource-assessment-program/fire-perimeters) was retrieved from CalFire[^8].

- [County level demographic information and geospatial data](https://www.census.gov/data/datasets/time-series/demo/popest/2010s-counties-total.html#par_textimage_70769902) were retrieved from the United States Census Bureau[^9].

## Methods

To start, I cleaned the data according to "Tidy Data" format such that I could join all my necessary information together. I divided the raw asthma hospitalization data by the population of each county, then multiplied by 100,000 to get the hospitalizations per 100,000 people. This was to account for the varying population sizes per county. I also capped the AQI value at 500 because that is the maximum standardized value listed on the EPA's website for air quality. Lastly, I used the area data and count data from CalFire to find the total acreage burned per year and total number of fires per year. This data was used to analyze trends in wildfire over time. 

For my analysis, I started with a linear regression model. Because I couldn't find open access data that directly quantified PM 2.5 from wildfires, I used a variety of measures of air quality from the EPA's Aiq Quality Index. I tried looking at the median AQI, maximum AQI, days with PM 2.5, days with ozone, and days unhealthy for sensitive groups or worse. While these predictors were similar, median aqi had the highest R<sup>2</sup> and smallest p-value. 

I also added some demographic variables such as median per capita income and population density to see if these were important predictors of asthma hospitalizations, but found they were not signifcant. The other variable I added that was very significant was year. 

#### Model 1: Linear model
Overall, my first model looks like this: 

$$log(hosp\_per\_100k) = \beta_0 + \beta_1 median\_aqi + \beta_2year + u_i$$
Where `hosp_per_100k` is asthma hospitalizations per 100,000 people. This variable has been log transformed to establish a linear relationship. `median_aqi` is the median aqi for that year. `year` represents the year of interest. 

After conducting my first analysis, I decided to check for autocorrelation in my dataset. It turns out, my data was highly autocorrelated, therefore I moved onto an autoregressive distributive lag model (ADL). 

#### Model 2: Autoregressive distributive lag model

$$log(hosp\_per\_100k)[t] = \beta_0 + \beta_1 median\_aqi[t] + \beta_2year[t] + \\ \beta_3log(hosp\_per\_100k)[t-1] + \beta_4 median\_aqi[t-1] + \beta_5year[t-1] + u_i$$
Where `t` is our data at `time = t` and `t-1` is our data at `time = t-1`. 

The ADL model accounted for much of the autocorrelation in the residuals of my first linear model. 

## Results and Discussion

```{r}
#| echo: false

library(tidyverse)
library(here)
library(janitor)
library(tmap)
library(sf)
library(spatialreg)
library(stargazer)
library(patchwork)
library(sjPlot)
library(sjmisc)
library(sjlabelled)
library(dynlm)

asthma_aqi <- read_sf(here("posts", "2024-12-13-asthma-aqi", "data",  "asthma_aqi.geojson"))

fire_asthma <- read_csv(here("posts", "2024-12-13-asthma-aqi", "data",  "fire_asthma.csv"))
```


### Linear Model
```{r}
#| code-fold: true
#| code-summary: "Reveal code"

asthma_mod <- lm(log(hosp_per_100k) ~ median_aqi + year + per_capita_income, data = asthma_aqi)

asthma_hosp_table <- tab_model(asthma_mod,
                               pred.labels = c("Intercept", 
                                               "Median AQI", 
                                               "Year", 
                                               "Per capita Income (in $1000s)"),
                               dv.labels = c("Asthma Hospitalizations (per 100k)"),
                               string.ci = "Conf. Int (95%)",
                               string.p = "P-value",
                               title = "Table 1. Linear Model Results",
                               digits = 3)

asthma_hosp_table
```

```{r}
#| echo: false

# Drop geometry for ADL mod
asthma_aqi <- asthma_aqi %>% 
  st_drop_geometry()
```


### ADL model
```{r}
#| code-fold: true
#| code-summary: "Reveal code"

adl_mod <- dynlm(
  log(hosp_per_100k) ~ L(log(hosp_per_100k), 1) + L(median_aqi, 0:1) + L(year, 0:1), ts(asthma_aqi, start = 2015)
)

adl_table <- tab_model(adl_mod,
                       pred.labels = c("Intercept", 
                                       "Lagged Hospitalizations\nper 100k", 
                                       "Median AQI",
                                       "Lagged Median AQI",
                                       "Year"),
                               dv.labels = c("Hospitalizations (per 100k)"),
                               string.ci = "Conf. Int (95%)",
                               string.p = "P-value",
                               title = "Table 2. ADL Model Results",
                               digits = 3)

adl_table
```
Model matrix is rank deficient. Parameters `L(year, 0:1)2` were not estimable.

### ACF plot 
```{r}
#| code-fold: true
#| code-summary: "Reveal code"

residual_acf_before <- acf(resid(asthma_mod), 
                           plot = FALSE, 
                           na.action = na.pass)

acf_before_df <- tibble(Lag = residual_acf_before$lag, 
                        ACF = as.vector(residual_acf_before$acf)) 

acf_before <-  ggplot(acf_before_df, aes(Lag, ACF)) + 
  geom_hline(yintercept = 0, 
             linetype = "dashed", 
             color = "cornflowerblue",
             linewidth = 1.5) +
  geom_line(linewidth = 2) +
  theme_minimal()

residual_acf_after <- acf(resid(adl_mod), 
                           plot = FALSE, 
                           na.action = na.pass)

acf_after_df <- tibble(Lag = residual_acf_after$lag, 
                        ACF = as.vector(residual_acf_after$acf)) 

acf_after <-  ggplot(acf_after_df, aes(Lag, ACF)) + 
  geom_hline(yintercept = 0, 
             linetype = "dashed", 
             color = "cornflowerblue",
             linewidth = 1.5) +
  geom_line(linewidth = 2) +
  theme_minimal()

acf_before + acf_after
```

### Fires and hospitalizations over time
```{r}
#| code-fold: true
#| code-summary: "Reveal code"

# Plot change in area burned over time
fire_plot <- ggplot(fire_asthma, aes(year, total_area)) +
  geom_col(fill="firebrick") + 
  labs(title="Total Area Burned by Wildfires\nin California by Year",
       x="Year",
       y="Area burned (acres)") +
  theme_minimal() +
    theme(axis.title = element_text(size=13),
        title = element_text(size=14))

# Plot change in hospitalizations over time
hosp_plot <- ggplot(fire_asthma, aes(year, total_hosp_capita)) +
  geom_col(fill="cornflowerblue") +
  labs(title="Total Asthma Hospitalizations per\nCapita in California by Year",
       x="Year",
       y="Hospitalizations per 100K") +
  theme_minimal() +
  theme(axis.title = element_text(size=13),
        title = element_text(size=14))

fire_plot | hosp_plot  
```


## Conclusion


### References

[^1]: World Health Organization: WHO, World Health Organization: WHO. Asthma. 6 May 2024. Available: https://www.who.int/news-room/fact-sheets/detail/asthma

[^2]: Health studies of criteria air pollutants. In: California Office of Environmental Health Hazard Assessment [Internet]. [cited 12 Dec 2024]. Available: https://oehha.ca.gov/air/health-studies-criteria-air-pollutants

[^3]: Aguilera, R., Corringham, T., Gershunov, A. et al. Wildfire smoke impacts respiratory health more than fine particles from other sources: observational evidence from Southern California. Nat Commun 12, 1493 (2021). https://doi.org/10.1038/s41467-021-21708-0

[^4]: D. Kiser et al., “Particulate matter and emergency visits for asthma: a time-series study of their association in the presence and absence of wildfire smoke in Reno, Nevada, 2013–2018,” Environ. Health, vol. 19, no. 1, p. 92, Aug. 2020, doi: 10.1186/s12940-020-00646-2.

[^5]: Technical assistance document for the reporting of daily air quality – the Air Quality Index (AQI). United States Environmental Protection Agency. 2024 May. Report No.: EPA-454/B-24-002. Available: https://document.airnow.gov/technical-assistance-document-for-the-reporting-of-daily-air-quailty.pdf 

[^6]: US Environmental Protection Agency. Air Quality System Data Mart AirNow available via https://www.epa.gov/outdoor-air-quality-data. Accessed December 8 2024.

[^7]: “Asthma Emergency Department Visit Rates by County - California Health and Human Services Open Data Portal,” CHHS Open Data. https://data.ca.gov/dataset/asthma-emergency-department-visit-rates (accessed Dec. 02, 2023). 

[^8]: California Department of Forestry and Fire Protection (CAL FIRE), [calfire_all.gdb], [2024-11-17], retrieved from CAL FIRE data portal. Accessed December 8 2024. 

[^9]: United States Census Bureau. County Population Totals: 2010-2019, 2020-2023. https://www.census.gov/data/datasets/time-series/demo/popest/2010s-counties-total.html#par_textimage_70769902. Accessed December 8 2024. 



